
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<title>Season Seven</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Django e-booklet">
<meta name="keywords" content="django, django learning">
<meta name="author" content="Mahdi Rezaie, Ali Ebrahimian">
<link rel="icon" href="../Images/favicon.ico" type="image/ico">

<link rel="stylesheet" type="text/css" href="https://virapy.github.io/assets/CSS/seasons-style.css">
<link rel="stylesheet" type="text/css" href="https://virapy.github.io/assets/CSS/Footer-style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<main>
    <div class="container">
        <div class="content">
            <h2>فصل هفتم: اپلیکیشن بلاگ (بخش چهارم)</h2><div class="toc"><h3>فهرست مطالب</h3><ul>
<li><a href="#yjd-sfhh-prwfyl">ایجاد صفحه پروفایل</a></li>
<li><a href="#fzwdn-pst-twst-khrbr">افزودن پست توسط کاربر</a></li>
<li><a href="#hdhf-pst-w-tswyr-n-twst-khrbr">حذف پست و تصاویر آن توسط کاربر</a></li>
<li><a href="#wyrysh-pst-w-hdhf-tswyr-n-twst-khrbr">ویرایش پست و حذف تصاویر آن توسط کاربر</a></li>
<li><a href="#hrz-hwyt-w-lgyn-wrwd">احراز هویت و لاگین (ورود)</a></li>
<li><a href="#lgyn-w-lg-wt-khrwj-mbtny-br-khls">لاگین و لاگ اوت (خروج) مبتنی بر کلاس</a></li>
<li><a href="#tgyyr-pswrd">تغییر پسورد</a></li>
<li><a href="#bznshny-reset-pswrd">بازنشانی (reset) پسورد</a></li>
<li><a href="#thbt-nm-register">ثبت نام (register)</a></li>
<li><a href="#tws-h-mdl-user-w-wyrysh-tl-t-shkhsy">توسعه مدل User و ویرایش اطلاعات شخصی</a></li>
<li><a href="#dsth-bndy-sdh">دسته بندی ساده</a></li>
<li><a href="#tmrynt-fsl-hftm-w-nkhty-dr-mwrd-blg-mhm">تمرینات فصل هفتم و نکاتی در مورد بلاگ (مهم)</a></li>
<li><a href="#nkhty-dr-khsws-styl-dhy">نکاتی در خصوص استایل دهی</a></li>
</ul></div>
<h3 id="yjd-sfhh-prwfyl">ایجاد صفحه پروفایل</h3>
<blockquote>
<p><strong>نکته:</strong> با هر نام کاربری که برای پنل ادمین لاگین کنیم، کاربر فعلی وبسایت هم همان user خواهد بود(در تمام صفحات سایت).</p>
</blockquote>
<h4><strong>ایجاد URL برای صفحه پروفایل:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;profile/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;profile&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<h4><strong>ایجاد view برای صفحه پروفایل:</strong></h4>
<p>توابعی که برای ایجاد view استفاده میکنیم یک آرگومان اجباری بنام request دارند.</p>
<p>با استفاده از request و ویژگی user برای آن، میتوان به کاربری که در سایت لاگین کرده دسترسی داشت.</p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="c1"># current user in website</span>
<span class="n">request</span><span class="o">.</span><span class="n">user</span>
</pre></div>

<p>خروجی که این دستور به ما میدهد، شامل اطلاعات آن کاربر؛ مثله (username, password, firstname, lastname) میباشد.</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">pub_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pub_posts&quot;</span><span class="p">:</span> <span class="n">pub_posts</span><span class="p">,</span>
        <span class="s2">&quot;all_posts&quot;</span><span class="p">:</span> <span class="n">all_posts</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/profile.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>

<p>در view نوشته شده ابتدا کاربری که در وبسایت لاگین کرده را در متغیری ذخیره کردیم.</p>
<p>حالا یکبار تمام پست های آن کاربر و بار دیگر فقط پست های منتشر شده  آن کاربر را از دیتابیس دریافت میکنیم.(البته فقط میتوان از پست های منتشر شده استفاده کرد).</p>
<p>پست های هر کاربر را در صفحه پروفایلش نمایش میدهیم.</p>
<h4><strong>ایجاد تمپلیت برای صفحه پروفایل:</strong></h4>
<p><code>templates/blog/profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Profile&lt;/h1&gt;</span>

<span class="x">    &lt;table&gt;</span>
<span class="x">        &lt;caption&gt;All Post&lt;/caption&gt;</span>
<span class="x">        &lt;tr&gt;</span>
<span class="x">            &lt;th&gt;row&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;title&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;edit&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;delete&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;status&lt;/th&gt;</span>
<span class="x">        &lt;/tr&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">all_posts</span> <span class="cp">%}</span>

<span class="x">            &lt;tr&gt;</span>
<span class="x">                &lt;!-- row --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>

<span class="x">                &lt;!-- title --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">get_absolute_url</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/td&gt;</span>

<span class="x">                &lt;!-- edit --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;#&quot;&gt;edit&lt;/a&gt;&lt;/td&gt;</span>

<span class="x">                &lt;!-- delete --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;#&quot;&gt;delete&lt;/a&gt;&lt;/td&gt;</span>

<span class="x">                &lt;!-- status --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">post.status</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">            &lt;/tr&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">    &lt;/table&gt;</span>

<span class="x">    &lt;table&gt;</span>
<span class="x">        &lt;caption&gt;Published Post&lt;/caption&gt;</span>
<span class="x">        &lt;tr&gt;</span>
<span class="x">            &lt;th&gt;row&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;title&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;description&lt;/th&gt;</span>
<span class="x">        &lt;/tr&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">pub_posts</span> <span class="cp">%}</span>
<span class="x">            &lt;tr&gt;</span>
<span class="x">                &lt;!-- row --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>

<span class="x">                &lt;!-- title --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">get_absolute_url</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/td&gt;</span>

<span class="x">                &lt;!-- description --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">post.description</span> <span class="o">|</span> <span class="nf">truncatewords</span><span class="o">:</span><span class="m">4</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">            &lt;/tr&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="x">    &lt;/table&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p>برای اینکه پروفایل در همه صفحات در دسترس باشد، در تمپلیت header( که به base.html وصله)، کنار فیلد search با استفاده از تگ a لینک آنرا ایجاد میکنیم تا کاربر را به صفحه پروفایل هدایت کند.</p>
<p><code>templates/partials/header.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">&lt;!-- search field --&gt;</span>
<span class="x">&lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;Blog:post_search&#39;</span> <span class="cp">%}</span><span class="x">&quot; method=&quot;get&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;text&quot; name=&quot;query&quot; required placeholder=&quot;عبارت مدنظر را وارد کنید&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;submit&quot; value=&quot;search&quot;&gt;</span>
<span class="x">&lt;/form&gt;</span>

<span class="x">&lt;!-- profile link --&gt;</span>
<span class="x">&lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:profile&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;profile&lt;/a&gt;&lt;/p&gt;</span>
</pre></div>

<h3 id="fzwdn-pst-twst-khrbr">افزودن پست توسط کاربر</h3>
<p>خب میخواهیم فرم افزودن پست را ایجاد کنیم؛  مدل Post برای ذخیره اطلاعات و ارتباط با دیتابیس از قبل ایجاد شده، درحال حاضر ما باید (form, template, URL, view) را ایجاد کنیم.</p>
<h4><strong>ایجاد URL برای فرم افزودن پست جدید:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;profile/create-post/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">create_post</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;create_post&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<p>حالا در صفحه پروفایل، یک لینک ایجاد میکنیم که با استفاده از URL بالا ، کاربر را به صفحه ایجاد پست جدید هدایت میکند.</p>
<p><code>templates/blog/profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Profile&lt;/h1&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:create_post&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Create Post&lt;/a&gt;</span>

<span class="x">    &lt;!-- ادامه کدها --&gt;</span>
<span class="x">    &lt;!-- ... --&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4><strong>ایجاد فرم افزودن پست جدید(forms.py):</strong></h4>
<p>در این فرم از ModelForm استفاده میکنیم.</p>
<blockquote>
<p>در فرم ایجاد پست تصویر هم داریم ولی تصویر جزء فیلدهای مدل Post نیست، بنابراین خارج از کلاس Meta فیلدهای تصویر را به صورت دستی ایجاد میکنیم.</p>
</blockquote>
<p><code>app directory/forms.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">CreatePostForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">image1</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;image1&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">image2</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;image2&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;reading_time&#39;</span><span class="p">]</span>
</pre></div>

<p>فیلدهای مدل Post که میخواهیم در فرم باشند را در کلاس Meta مشخص میکنیم.</p>
<h4><strong>ایجاد view برای فرم ایجاد پست جدید:</strong></h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">create_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CreatePostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>

            <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># ...ذخیره تصاویر آپلود شده در مدل (تصویر)، پس از ایجاد پست (در صورت وجود تصویر)</span>

            <span class="c1"># :اسم فیلدهای تصویر در فرم</span>
            <span class="n">all_images</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;image1&#39;</span><span class="p">,</span> <span class="s1">&#39;image2&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">all_images</span><span class="p">:</span>
                <span class="n">img_file</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">img_file</span><span class="p">:</span>
                    <span class="n">Image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">img_file</span><span class="o">=</span><span class="n">img_file</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;Blog:profile&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CreatePostForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;forms/create_post.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>

<p>1- برای فرم CreatePostForm افزون بر request.POST (که در فرم های قبلی هم از آن استفاده کرده ایم) لازم است از request.FILES هم استفاده کنیم؛ <strong>دلیلش هم این است که در این فرم از فایل (تصویر) استفاده میکنیم.</strong></p>
<blockquote>
<p>بنابراین در فرم هایی که با file سر و کار دارند باید کنار request.POST از request.FILES هم استفاده کنیم.</p>
</blockquote>
<p>2- پس از بررسی معتبر بودن فیلدها؛ لازم است اطلاعات فرم را در دیتابیس ذخیره کنیم ولی قبل از ذخیره، نویسنده پست(request.user) را به آن اضافه میکنیم.</p>
<p>3- فیلد تصاویر را اختیاری قرار دادیم پس ممکن است کاربری هیچ تصویری آپلود نکند؛ بنابراین برای جلوگیری از ایجاد آبجکت خالی برای مدل Image از شرط استفاده میکنیم تا اگر تصویر وجود داشت آنرا ذخیره کند.</p>
<p>4- پس از ایجاد پست به صفحه پروفایل redirect میشه.</p>
<h4><strong>تکمیل اتوماتیک فیلد slug از روی فیلد title:</strong></h4>
<p>مثله پنل ادمین که فیلد slug، اتوماتیک از روی فیلد title تکمیل میشد؛ برای اینکه در فرم create_post هم slug اتوماتیک تکمیل شود لازم است متد <span class="en-text">save()</span> را در مدل Post بازنویسی(override) کنیم.</p>
<p>قبل از بازنویسی باید ماژول slugify را ایمپورت کنیم:</p>
<p><code>app directory/models.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.template.defaultfilters</span> <span class="kn">import</span> <span class="n">slugify</span>
</pre></div>

<p><strong>بازنویسی متد <span class="en-text">save()</span>:</strong></p>
<p><code>app directory/models.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

<p>داخل پرانتزهای slugify مشخص میکنیم، slug براساس کدام فیلد تکمیل شود.</p>
<h4><strong>ایجاد تمپلیت برای فرم افزودن پست جدید:</strong></h4>
<p>در تمپلیت(create_post.html)، برای فرم افزودن پست جدید از متد post استفاده میکنیم.</p>
<blockquote>
<p><strong>نکته خیلی مهم:</strong> چون در فرم با file (تصویر) سر و کار داریم، باید برای تگ form از اتریبیوت enctype استفاده کنیم.</p>
<p>چون متد فرم post هستش، باید از {% csrf_token %} هم استفاده کنیم.</p>
</blockquote>
<p><strong>تمپلیت ایجاد پست جدید:</strong></p>
<p><code>templates/forms/create_post.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Create Post </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

<span class="x">    &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;send&quot; class=&quot;sub&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>

<span class="x">    &lt;!-- نمایش خطاها --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.non_field_errors</span> <span class="cp">}}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> </span>

<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
<span class="x">                    </span><span class="cp">{{</span> <span class="nv">field.label</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">   </span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> </span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">  </span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h3 id="hdhf-pst-w-tswyr-n-twst-khrbr">حذف پست و تصاویر آن توسط کاربر</h3>
<p>برای حذف پست در پروفایل، یک لینک ایجاد کردیم  حالا برای href آن، باید یک URL ایجاد کنیم.</p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;profile/delete-post/&lt;post_id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">delete_post</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;delete_post&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<h4><strong>ایجاد view برای حذف پست ها:</strong></h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">delete_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">post</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;Blog:profile&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;forms/delete-post.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;post&#39;</span><span class="p">:</span> <span class="n">post</span><span class="p">})</span>
</pre></div>

<h4><strong>ایجاد تمپلیت برای تایید حذف پست ها:</strong></h4>
<p>یک تمپلیت برای تایید حذف پست ایجاد میکنیم، البته میتوان با جاوااسکریپت در همان تمپلیت پروفایل تایید حذف را نمایش دهیم.</p>
<p><code>templates/forms/delete_post</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> post delete </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h2&gt;آیا از حذف پست </span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="x"> مطمئن هستید؟!&lt;/h2&gt;</span>
<span class="x">    &lt;br&gt;</span>

<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:profile&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;بازگشت به صفحه پروفایل&lt;/a&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;حذف&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p>برای اینکه با حذف پست، تصاویر مربوط به آن هم حذف شوند لازم است متد <span class="en-text">delete()</span> را برای مدل Post بازنویسی(override) کنیم، البته میتوان از پکیج django-cleanup هم برای این کار استفاده کرد.</p>
<p><code>app directory/models.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">storage</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">img_file</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">img_file</span><span class="o">.</span><span class="n">path</span>

            <span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

<h4>توضیحات:</h4>
<p>چون چند تصویر وجود داره و باید یکی یکی حذف شوند، روی تمام تصاویر پست حلقه میزنیم.</p>
<blockquote>
<ul>
<li>
<p><strong>اتریبیوت storage:</strong> یک مفهوم است که به شما کمک می‌کند فایل‌ها را در سیستم فایل یا در یک مکان ذخیره‌سازی دیگر مدیریت کنید. این ابزار به شما امکان می‌دهد تا به فایل‌هایی که به اشیاء مختلفی مثل پست‌ها مرتبط هستند دسترسی داشته باشید و آن‌ها را مدیریت کنید.</p>
</li>
<li>
<p><strong>اتریبیوت path:</strong>  به مسیر فایل فیزیکی در سیستم فایل اشاره دارد. در کد شما، path مسیر فایل تصاویر مرتبط با هر پست است. این مسیر برای دسترسی به فایل‌ها و همچنین برای حذف آن‌ها از سیستم فایل استفاده می‌شود.</p>
</li>
</ul>
<p>به این ترتیب، storage ابزاری برای مدیریت فایل‌ها و path آدرس دقیق فایل‌ها در سیستم فایل است که برای عملیاتی مانند حذف فایل‌ها یا دسترسی به آن‌ها استفاده می‌شود.</p>
</blockquote>
<p>خب با override(بازنویسی) کردن متد <span class="en-text">delete()</span> برای مدل Post، زمانی که پست حذف شود تمام تصاویر مربوط به آن هم حذف میشوند.</p>
<h3 id="wyrysh-pst-w-hdhf-tswyr-n-twst-khrbr">ویرایش پست و حذف تصاویر آن توسط کاربر</h3>
<p>میخواهیم برای ویرایش پست ها هم مثله ایجاد پست، یک فرم داشته باشیم.</p>
<p>تفاوت ویرایش پست با ایجاد پست در این است که در ویرایش، روی یک آبجکتی که از قبل وجود داره کار میکنیم.</p>
<p>برای ویرایش پست باید یک URL و view ایجاد کنیم، ولی نیازی به ایجاد فرم و تمپلیت جدید نداریم، و از همان فرم و تمپلیت create_post استفاده میکنیم.</p>
<h4><strong>ایجاد URL برای ویرایش پست ها:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;profile/edit-post/&lt;post_id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">edit_post</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;edit_post&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<blockquote>
<p>در صفحه پروفایل برای ویرایش پست ها لینک نوشته ایم حالا برای href آنها از URL که برای ویرایش پست در بالا ایجاد کرده ایم استفاده میکنیم.</p>
</blockquote>
<h4><strong>ایجاد view برای ویرایش پست ها:</strong></h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">edit_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">post_id</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">post_id</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CreatePostForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">post</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># :اسم فیلدهای تصویر در فرم</span>
            <span class="n">all_images</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;image1&#39;</span><span class="p">,</span> <span class="s1">&#39;image2&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">all_images</span><span class="p">:</span>
                <span class="n">img_file</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">img_file</span><span class="p">:</span>
                    <span class="n">Image</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">img_file</span><span class="o">=</span><span class="n">img_file</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;Blog:profile&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CreatePostForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;forms/create_post.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;post&#39;</span><span class="p">:</span> <span class="n">post</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>

<h4>توضیحات:</h4>
<p>1- برای ویرایش پست ابتدا باید آن پست را بدست بیاوریم، بنابراین با استفاده از post_id که از url دریافت کرده ایم؛ پست را از دیتابیس گرفته و آنرا در یک متغیر ذخیره میکنیم.</p>
<p>2- برای اینکه اطلاعات پست موجود را در فرم خود داشته باشیم؛ برای فرم خود از آرگومان instance استفاده کرده و متغیر post را برایش مشخص میکنیم. | اینطوری فیلدهای فرم، براساس محتوای پست پر شده و نمایش داده میشوند.</p>
<blockquote>
<p>سایر بخش ها قبلا توضیح داده شده است.</p>
</blockquote>
<p>برای ویرایش پست از همان تمپلیت create_post استفاده میکنیم در واقع این تمپلیت برای هردو مشترک استفاده میشود.</p>
<p>فقط یکسری تغییرات جزئی برای نمایش تصاویر پست در تمپلیت ایجاد میکنیم:</p>
<p><code>templates/forms/create_post.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Create &amp; edit Post </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

<span class="x">    &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;send&quot; class=&quot;sub&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>

<span class="x">    &lt;!-- نمایش تصاویر پست --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">post</span> <span class="k">and</span> <span class="nv">post.images.exists</span> <span class="cp">%}</span>
<span class="x">        &lt;div class=&quot;photos&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">pic</span> <span class="k">in</span> <span class="nv">post.images.all</span> <span class="cp">%}</span>
<span class="x">                &lt;div class=&quot;photo&quot;&gt;</span>
<span class="x">                    &lt;img src=&quot;</span><span class="cp">{{</span> <span class="nv">pic.img_file.url</span> <span class="cp">}}</span><span class="x">&quot; alt=&quot;pic.img_file&quot;&gt;</span>
<span class="x">                &lt;/div&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="x">    &lt;!-- نمایش خطاها --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.non_field_errors</span> <span class="cp">}}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> </span>

<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
<span class="x">                    </span><span class="cp">{{</span> <span class="nv">field.label</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">   </span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> </span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">  </span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p>میتوانیم برای تصاویر دکمه حذف اضافه کنیم.</p>
<p><strong>مثله حذف پست ها برایش URL و view ایجاد میکنیم ولی دیگه تمپلیت برای تایید حذف ایجاد نمیکنیم.</strong></p>
<h4><strong>ایجاد url برای حذف تصاویر:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;profile/delete-image/&lt;image_id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">delete_image</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;delete_image&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<p><strong>دکمه حذف تصاویر در تمپلیت create_post:</strong></p>
<blockquote>
<p>برای درک راحت تر در کد زیر فرم و ارورها را نمایش نداده ایم.</p>
</blockquote>
<p><code>templates/forms/create_post.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Create &amp; edit Post </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;!-- form --&gt;</span>
<span class="x">    &lt;!-- ... --&gt;</span>

<span class="x">    &lt;!-- نمایش تصاویر پست --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">post</span> <span class="k">and</span> <span class="nv">post.images.exists</span> <span class="cp">%}</span>
<span class="x">        &lt;div class=&quot;photos&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">pic</span> <span class="k">in</span> <span class="nv">post.images.all</span> <span class="cp">%}</span>
<span class="x">                &lt;div class=&quot;photo&quot;&gt;</span>
<span class="x">                    &lt;img src=&quot;</span><span class="cp">{{</span> <span class="nv">pic.img_file.url</span> <span class="cp">}}</span><span class="x">&quot; alt=&quot;pic.img_file&quot;&gt;</span>

<span class="x">                    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:delete_image&#39;</span> <span class="nv">pic.id</span> <span class="cp">%}</span><span class="x">&quot;&gt;delete image&lt;/a&gt;</span>
<span class="x">                &lt;/div&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="x">    &lt;!-- نمایش خطاها --&gt;</span>
<span class="x">    &lt;!-- ... --&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4><strong>ایجاد view برای حذف تصاویر:</strong></h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">delete_image</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">image_id</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Image</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">image_id</span><span class="p">)</span>
    <span class="n">image</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;blog:profile&#39;</span><span class="p">)</span>
</pre></div>

<p>با این حال تصویر از پروژه حذف نمیشود، خب راهکار چیه؟!</p>
<p>باید برای مدل Image متد <span class="en-text">delete()</span> را override کنیم. | بدنه متد <span class="en-text">delete()</span> برای مدل Image کمی متفاوت نوشته میشود.</p>
<p><code>app directory/models.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># Image فیلدهای مدل </span>
    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">storage</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_file</span><span class="o">.</span><span class="n">storage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_file</span><span class="o">.</span><span class="n">path</span>

        <span class="n">storage</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

<p>شاید برای برخی دوستان سوال پیش آمده باشه که اگه بخواهیم تمپلیت create_post.html را که برای هر دو فرم ایجاد پست و ویرایش پست مشترک است را به صورت دستی و با تگ های input ایجاد کنیم ساختار چگونه است؟!</p>
<p>خب بریم ببینیم:</p>
<p><code>templates/forms/create_post.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Create &amp; edit Post </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

<span class="x">    &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        &lt;!-- _____________________________ inputs _____________________________ --&gt;</span>

<span class="x">        &lt;input type=&quot;text&quot; name=&quot;title&quot; value=&quot;</span><span class="cp">{{</span> <span class="nv">form.title.value</span><span class="o">|</span><span class="nf">default_if_none</span><span class="s1">:&#39;&#39;</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>

<span class="x">        &lt;textarea name=&quot;description&quot;&gt;</span><span class="cp">{{</span> <span class="nv">form.description.value</span><span class="o">|</span><span class="nf">default_if_none</span><span class="s1">:&#39;&#39;</span> <span class="cp">}}</span><span class="x">&lt;/textarea&gt;</span>

<span class="x">        &lt;input type=&quot;number&quot; min=0 name=&quot;reading_time&quot; value=&quot;</span><span class="cp">{{</span> <span class="nv">form.reading_time.value</span><span class="o">|</span><span class="nf">default_if_none</span><span class="s1">:&#39;&#39;</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>

<span class="x">        &lt;input type=&quot;file&quot; name=&quot;image1&quot;&gt;</span>
<span class="x">        &lt;input type=&quot;file&quot; name=&quot;image2&quot;&gt;</span>

<span class="x">        &lt;!-- _________________________________________________________________ --&gt;</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;send&quot; class=&quot;sub&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>

<span class="x">    &lt;!-- نمایش تصاویر پست --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">post</span> <span class="k">and</span> <span class="nv">post.images.exists</span> <span class="cp">%}</span>
<span class="x">        &lt;div class=&quot;photos&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">pic</span> <span class="k">in</span> <span class="nv">post.images.all</span> <span class="cp">%}</span>
<span class="x">                &lt;div class=&quot;photo&quot;&gt;</span>
<span class="x">                    &lt;img src=&quot;</span><span class="cp">{{</span> <span class="nv">pic.img_file.url</span> <span class="cp">}}</span><span class="x">&quot; alt=&quot;pic.img_file&quot;&gt;</span>
<span class="x">                &lt;/div&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="x">    &lt;!-- نمایش خطاها --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.non_field_errors</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.non_field_errors</span> <span class="cp">}}</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> </span>

<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">field.errors</span> <span class="cp">%}</span>
<span class="x">                    </span><span class="cp">{{</span> <span class="nv">field.label</span> <span class="cp">}}</span><span class="x">: </span><span class="cp">{{</span> <span class="nv">error</span> <span class="cp">}}</span>
<span class="x">                </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">   </span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> </span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">  </span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p>استفاده از ساختار <span class="en-text">{{ form.field-name.value|default_if_none:"" }}</span> برای اتریبیوت value باعث میشود که در حالت ایجاد پست (که از طرف view تعیین میشود) فیلدها خالی نمایش داده شوند و وقتی حالت ویرایش پست باشد فیلدها براساس محتوای فیلد پر نمایش داده میشوند.</p>
<h3 id="hrz-hwyt-w-lgyn-wrwd">احراز هویت و لاگین (ورود)</h3>
<p><strong>میخواهیم اگر کاربر لاگین کرده بود username کاربر را نمایش دهیم و در غیر این صورت یک دکمه برای لاگین کردن نمایش دهیم:</strong></p>
<p>این قابلیت را در تمپلیت header انجام میدهیم تا در همه صفحات وجود داشته باشد.</p>
<p><code>templates/partials/header.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">&lt;!-- search field --&gt;</span>
<span class="x">&lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;Blog:post_search&#39;</span> <span class="cp">%}</span><span class="x">&quot; method=&quot;get&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;text&quot; name=&quot;query&quot; required placeholder=&quot;عبارت مدنظر را وارد کنید&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;submit&quot; value=&quot;search&quot;&gt;</span>
<span class="x">&lt;/form&gt;</span>

<span class="x">&lt;!-- profile link --&gt;</span>
<span class="x">&lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:profile&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;profile&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">&lt;!-- login button --&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">    &lt;div&gt;</span>
<span class="x">        &lt;a href=&quot;#&quot;&gt;</span><span class="cp">{{</span> <span class="nv">request.user.username</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;a href=&quot;#&quot;&gt;Login&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>

<blockquote>
<p>request هم توی تمپلیت و هم توی view قابل استفاده میباشد.</p>
<p><span class="rtl-text">دستور <strong>request.user</strong>، کاربری که لاگین کرده است را برمیگرداند(کاربر فعلی)، متد <strong><span class="en-text">is_authenticated()</span></strong> هم بررسی میکنه کاربر احراز هویت شده یا نه؟(لاگین کرده یا نه؟!)</span></p>
</blockquote>
<h4><strong>پیاده سازی قابلیت لاگین برای وبسایت:</strong></h4>
<p>django authentication system: فریمورک(سیستم) احراز هویت جنگو میباشد.</p>
<blockquote>
<p>این فریمورک به صورت پیشفرض در جنگو وجود درد. | نیازی به نصب یا اعمال تنظیمات ندارد.</p>
<p>برای هندل(مدیریت) کردن authentication, sessions, permisions و... استفاده میشه.</p>
</blockquote>
<p>این فریمورک در مسیر django.contrib.auth قرار داره.</p>
<h4><strong>ایجاد URL برای صفحه لاگین</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">user_login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<p>از این url برای href دکمه لاگین که در header ایجاد کردیم، استفاده میکنیم:</p>
<p><code>templates/partials/header.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">&lt;!-- search field &amp; profile link --&gt;</span>
<span class="x">&lt;!-- ... --&gt;</span>

<span class="x">&lt;!-- login button --&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">    &lt;div&gt;</span>
<span class="x">        &lt;a href=&quot;#&quot;&gt;</span><span class="cp">{{</span> <span class="nv">request.user.username</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:login&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Login&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>

<h4><strong>ایجاد فرم لاگین در forms.py</strong></h4>
<p><code>app directory/forms.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">)</span>
</pre></div>

<h4><strong>ایجاد view برای صفحه لاگین:</strong></h4>
<p>جهت استفاده از سیستم احراز هویت، برای لاگین لازم است مواردی را ایمپورت کنیم:</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span>
</pre></div>

<p>ساختار کد view:</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">user_login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">cd</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">cd</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">password</span><span class="o">=</span><span class="n">cd</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
                    <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;Blog:profile&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;Your account is disabled!&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;you are not logged in&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;forms/login.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>

<h4>توضیحات:</h4>
<p>1- اطلاعات فرم را از تمپلیت دریافت کرده و به LoginForm ارسال میکنیم.</p>
<blockquote>
<p>باید بررسی کنیم این username و password توی دیتابیس وجود درند یا نه؟!</p>
<p>از کلاس authenticate، برای این احراز هویت(بررسی username و password) استفاده میکنیم، اگه کاربر وجود داشته باشد آن کاربر را برمیگرداند و در غیر این صورت None برگردانده میشود.</p>
</blockquote>
<p>2- برای بررسی احراز هویت، username و password را برای کلاس authenticate مشخص میکنیم.</p>
<p>3- چنانچه کاربری با آن اطلاعات وجود داشت، لازم است بررسی کنیم که آن کاربر active میباشد یا اینکه deactive شده است.</p>
<blockquote>
<p>اگه کاربر active بود از کلاس login استفاده کرده و request و  user را جهت لاگین کردن برایش مشخص میکنیم.</p>
<p>و پس از لاگین کردن کاربر را به صفحه پروفایل redirect میکنیم.</p>
<p>اگر هم کاربر deactive بود برایش یک پیام با محتوای "حساب شما غیرفعال شده" نمایش میدهیم.</p>
</blockquote>
<p>4- اگر کاربری با اطلاعات وارد شده وجود نداشت پیام با محتوای "شما لاگین نکرده اید" نمایش میدهیم.</p>
<h4><strong>ایجاد تمپلیت برای صفحه لاگین:</strong></h4>
<p><code>templates/forms/login.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Login </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;login&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Enter your informations please...&lt;/p&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;login&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h3 id="lgyn-w-lg-wt-khrwj-mbtny-br-khls">لاگین و لاگ اوت (خروج) مبتنی بر کلاس</h3>
<p>تمپلیت فیلتر default: در صورتی که متغیر وجود نداشت مقدار پیشفرض که برایش مشخص میکنیم را نمایش میدهد.</p>
<p>مثلا توی header مشخص میکنیم، اگر کاربر لاگین کرده first_name کاربر را نمایش بده و اگر first_name وجود نداشت؛ username آن کاربر را نمایش دهد.</p>
<p><code>templates/partials/header.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">&lt;!-- search field --&gt;</span>
<span class="x">&lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;Blog:post_search&#39;</span> <span class="cp">%}</span><span class="x">&quot; method=&quot;get&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;text&quot; name=&quot;query&quot; required placeholder=&quot;عبارت مدنظر را وارد کنید&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;submit&quot; value=&quot;search&quot;&gt;</span>
<span class="x">&lt;/form&gt;</span>

<span class="x">&lt;!-- profile link --&gt;</span>
<span class="x">&lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:profile&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;profile&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">&lt;!-- login button --&gt;</span>
<span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">    &lt;div&gt;</span>
<span class="x">        &lt;a href=&quot;#&quot;&gt;</span><span class="cp">{{</span> <span class="nv">request.user.first_name</span> <span class="o">|</span> <span class="nf">default</span><span class="o">:</span><span class="nv">request.user.username</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;a href=&quot;#&quot;&gt;Login&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>

<p>جنگو برای احراز هویت (auth) یکسری class based view داره که کار ما را برای احراز هویت راحت تر میکند.</p>
<blockquote>
<p>نمونه هایی از آنها عبارتند از: LoginView, LogoutView, PasswordChange, PasswordReset</p>
</blockquote>
<p>ما میتوانیم مستقیما از این class based view ها استفاده کنیم، و یا مثل ListView و DetailView، آنها را شخصی سازی کنیم.</p>
<blockquote>
<p>برای "class based view" ها form  و view به صورت پیشفرض وجو دارد.</p>
<p>پس وقتی بدون شخصی سازی از class based view ها استفاده کنیم نیازی به view و form نداریم.</p>
</blockquote>
<p>برای استفاده مستقیم و بدون شخصی سازی از class based view ها در urls.py آنها را ایمپورت کرده و از آنها استفاده میکنیم.</p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
</pre></div>

<p>برای آن اسم مستعار مشخص مینیم تا با اسکریپت views که ایمپورت شده به تداخل نخورد و مشکلی پیش نیاید.</p>
<h4><strong>ایجاد url برای لاگین و لاگ اوت با استثاده از class based view:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;logout/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LogoutView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<p><strong>نکته:</strong> جنگو توی تنظیماتش یکسری مسیر پیشفرض داره؛ مثل مسیر فایل های static و یا تمپلیت ها که templates میباشد، فریمورک احراز هویت جنگو، مسیر تمپلیت هایش به صورت پیشفرض registration میباشد.(این دایرکتوری باید در templates ایجاد شود.)</p>
<p>تمپلیت هایی که برای این class based view ها ایجاد میکنیم باید در دایرکتوری registration قرار بگیرند.</p>
<blockquote>
<p>برای اینکه LoginView تمپلیت ما را تشخیص دهد لازم است تمپلیت login را به دایرکتوری registration منتقل کنیم.</p>
<p>سیستم احراز هویت برای تمپلیت هایی که برایش ایجاد میشوند نام پیشفرض داره برای مثال: login.html و یا logged_out.html</p>
</blockquote>
<p>وقتی از class based view ها استفاده میکنیم، متغیر form را در تمپلیت تشخیص میدهد.</p>
<h4><strong>الزام به لاگین کردن برای برخی صفحات:</strong></h4>
<p>برخی صفحات مثل صفحات پروفایل، ایجاد پست جدید، ویرایش پست و...؛ تا زمانی که کاربر لاگین نکرده است نباید نمایش داده شوند، پس لازم است view این طور صفحات را الزام به لاگین کنیم.</p>
<p>برای این کار از دکوراتور login_required استفاده میکنیم که باید ایمپورت شود:</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="kn">import</span> <span class="n">login_required</span>
</pre></div>

<p>حالا قبل از view هر صفحه ای که باید الزام به لاگین باشد از این دکوراتور استفاده میکنیم.</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="nd">@login_required</span>
<span class="o">&gt;</span><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">request</span><span class="p">):</span><span class="o">...</span>

<span class="c1"># ---------------------------------------------------------------</span>

<span class="nd">@login_required</span>
<span class="o">&gt;</span><span class="k">def</span> <span class="nf">create_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span><span class="o">...</span>
</pre></div>

<blockquote>
<p>چنانچه کاربری در وبسایت لاگین نکرده باشد، این دکوراتور کاربر را به صفحه لاگین منتقل میکند.</p>
</blockquote>
<h4><strong>تغییرات جزئی در تمپلیت صفحه لاگین:</strong></h4>
<p>حالا برای فرم لاگین یک تغییر ایجاد میکنیم؛ قبل از دکمه submit یک input با تایپ hidden ایجاد میکنیم، و برای آن اتریبیوت های name  و value با مقادیر زیر مشخص میکینم:</p>
<p><code>templates/registration/login.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Login </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;login&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Enter your informations please...&lt;/p&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;hidden&quot; name=&quot;next&quot; value=&quot;</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>
<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;login&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<blockquote>
<p>متغیر next خودکار توسط LoginView ارسال میشه.</p>
</blockquote>
<p><strong>خب این next چی هست اصلا و چکار میکنه؟!</strong></p>
<p>در واقع یک url هست که مشخص میکنه پس از لاگین کردن به چه صفحه ای منتقل شویم.</p>
<p>این next برای صفحاتی که الزام به لاگین هستند کاربرد دارد.</p>
<p><strong>بریم یک مثال بزنیم:</strong></p>
<blockquote>
<p>فرض کنیم میخواهیم به صفحه افزودن پست برویم ولی هنوز در وبسایت لاگین نکرده ایم؛</p>
<p>وقتی که میخواهیم به صفحه افزودن پست برویم چون این صفحه الزام به لاگین میباشد ما را به صفحه لاگین منتقل میکند با این حال متغیر next آدرس (URL) صفحه افزودن پست را در خود نگه میدارد و زمانی که لاگین کردیم به کمک آن url ما را به آن صفحه منتقل میکند.</p>
</blockquote>
<h4><strong>تنظیمات مربوط به login و logout:</strong></h4>
<p>برای اینکه url "لاگین" و "لاگ اوت" به درستی کار کنند لازم است در تنظیمات پروژه تغییراتی اعمال کنیم.</p>
<p><code>project directory/settings.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="c1"># ...</span>

<span class="n">LOGIN_REDIRECT_URL</span> <span class="o">=</span> <span class="s1">&#39;/profile/&#39;</span>
<span class="n">LOGIN_URL</span> <span class="o">=</span> <span class="s1">&#39;/login/&#39;</span>
<span class="n">LOGOUT_URL</span> <span class="o">=</span> <span class="s1">&#39;/logout/&#39;</span>
</pre></div>

<p><strong>توضیحات:</strong></p>
<p>متغیر اول مسیر پیشفرضی است که میخواهیم پس از لاگین شدن به آن صفحه منتقل شویم.</p>
<p>متغیر دوم و سوم هم مسیر(URL) صفحات login و logout هستند که در پروژه خود مشخص کرده ایم.</p>
<p><strong>نکته:</strong> کاراکتر اسلش (/)، که در ابتدای url ها قرار گرفته الزامی میباشد چون در ادامه آدرس، قرار میگیره و اگه نباشد ارور میدهد.</p>
<blockquote>
<p><span class="en-text">URL/profile</span></p>
<p><span class="en-text">URL/login</span></p>
<p><span class="en-text">URL/logout</span></p>
</blockquote>
<h4><strong>نکته خیلی مهم:</strong></h4>
<p><code>project directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;Blog.urls&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;Blog&#39;</span><span class="p">))</span>
<span class="p">]</span>
</pre></div>

<blockquote>
<p><span class="rtl-text"><strong>نکته مهم:</strong> در urls.py پروژه، همان طور که در بالا مشاهده میکنید، عبارتی برای اپلیکیشن خود مشخص نکردیم برای همین در تنظیمات مربوط به login و logout هم عبارتی نوشته نشده است.</span></p>
<p>حالا فرض کنیم، ما برای اپلیکیشن از عبارت blog در urls.py استفاده کرده ایم بنابراین متغیر ها را به صورت زیر مینویسیم.</p>
<blockquote>
<p><span class="en-text">LOGIN_REDIRECT_URL = '/blog/profile/'</span></p>
<p><span class="en-text">LOGIN_URL = '/blog/login/'</span></p>
<p><span class="en-text">LOGOUT_URL = '/blog/logout/'</span></p>
</blockquote>
</blockquote>
<h4><strong>ایجاد دکمه logout:</strong></h4>
<p>برای "logout" یک دکمه در صفحه پروفایل ایجاد میکنیم؛ و برای href آن، URL مربوط به "logout" را مشخص میکنیم:</p>
<p><code>templates/blog/profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Profile&lt;/h1&gt;</span>

<span class="x">    &lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:logout&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Logout&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:create_post&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Create Post&lt;/a&gt;</span>

<span class="x">    &lt;!-- ادامه کدها --&gt;</span>
<span class="x">    ...</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4><strong>بریم برای logout تمپلیت شخصی سازی شده ایجاد کنیم:</strong></h4>
<p>این تمپلیت را برای "logout" که با ساختار class-based-view پیاده سازی شده است؛ استفاده میکنیم، بنابراین در دایرکتوری registration قرار میگیرد.</p>
<p><code>templates/registration/logged_out.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Logout </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;you logged out&lt;/h1&gt;</span>
<span class="x">    &lt;br&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:login&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;login again&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p><strong>نکته مهم:</strong></p>
<blockquote>
<p>زمانیکه از class-based-view استفاده میکنیم برای اینکه تمپلیت های شخصی سازی شده ما  را بجای تمپلیت های پیشفرض نمایش دهد باید تغییراتی در تنظیمات ایجاد کنیم؛</p>
<p>-اسم اپلیکیشن خود را در بالای لیست INSTALLED_APPS قرار دهیم.</p>
<p>-اسم app خود را در بالای admin و auth قرار میدهیم، تا تمپلیت های ما در اولویت قرار بگیرند.</p>
</blockquote>
<p><code>project directory/settings.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="c1"># Application definition</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;blog.apps.BlogConfig&#39;</span><span class="p">,</span>

    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>

<h4><strong>خب بریم logout را با ساختار توابع ایجاد کنیم:</strong></h4>
<p>این بار میخواهیم بدون استفاده از class based view و با توابع logout را پیاده سازی کنیم.</p>
<p><strong>ایجاد url برای logout:</strong></p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;logout/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">log_out</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<p><strong>ایجاد view برای logout:</strong></p>
<p>باید logout را ایمپورت کنیم:</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">logout</span>


<span class="k">def</span> <span class="nf">log_out</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HTTP_REFERER&#39;</span><span class="p">))</span>
</pre></div>

<p>اگر بخواهیم پس از logout از هر صفحه ای، به همان صفحه برگردد از عبارت زیر استفاده میکنیم.</p>
<blockquote>
<p><span class="en-text">return redirect(request.META.get('HTTP_REFERER'))</span></p>
</blockquote>
<h3 id="tgyyr-pswrd">تغییر پسورد</h3>
<p>برای تغییر پسورد هم از class-based-view های احراز هویت استفاه میکنیم.</p>
<p>برای تغییر پسورد، دو URL ایجاد میکنیم، یکی برای فرم تغییر پسورد و دیگری برای صفحه ای که پیغام "تغییر موفقیت آمیز پسورد" را نمایش میدهد.</p>
<h4><strong>ایجاد url:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-change/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">success_url</span><span class="o">=</span><span class="s1">&#39;done&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-change/done/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeDoneView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change_done&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<blockquote>
<p>آرگومان success_url زمانی استفاده می‌شود که شما می‌خواهید بعد از انجام موفقیت‌آمیز یک عملیات (مثلاً تغییر رمز عبور)، کاربر به یک صفحه مشخص هدایت شود. به عبارت دیگر، این آرگومان مشخص می‌کند که بعد از اتمام موفقیت‌آمیز عملیات جاری، به چه صفحه ای(URL) منتقل شود.</p>
<ul>
<li>مقدار success_url می‌تواند یک URL نسبی (مانند 'done') یا یک URL کامل باشد.</li>
</ul>
<p><strong>به طور خلاصه، success_url یک ابزار مهم در ویوهای مبتنی بر کلاس در جنگو است که به شما امکان می‌دهد جریان کاری کاربر را بعد از انجام موفقیت‌آمیز یک عملیات کنترل کنید.</strong></p>
</blockquote>
<h4><strong>برای هر کدام از این URL ها یک تمپلیت در مسیر(دایرکتوری) registration ایجاد میکنیم:</strong></h4>
<p><code>templates/registration/password_change_form.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Change Password </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Change Password&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Enter previous password and new password:&lt;/p&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;Change Password&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p><code>templates/registration/password_change_done.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Change Password </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Password was changed successfully!&lt;/h1&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p>برای استفاده از قابلیت تغییر پسورد؛ در صفحه پروفایل یک لینک (دکمه) ایجاد کرده و برای href آن، از URL فرم تغییر پسورد استفاده میکینم.</p>
<p><code>templates/blog/profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Profile&lt;/h1&gt;</span>

<span class="x">    &lt;!-- logout button --&gt;</span>
<span class="x">    &lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:logout&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Logout&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">    &lt;!-- Change Password button --&gt;</span>
<span class="x">    &lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:password_change&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Change Password&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">    &lt;!-- create post button --&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:create_post&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Create Post&lt;/a&gt;</span>

<span class="x">    &lt;!-- ادامه کدها --&gt;</span>
<span class="x">    ...</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h3 id="bznshny-reset-pswrd">بازنشانی (reset) پسورد</h3>
<p>برای ریست پسورد، از 4 URL استفاده میکنیم.</p>
<h4><strong>ایجاد URL برای بازنشانی پسورد:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-reset/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">success_url</span><span class="o">=</span><span class="s1">&#39;done&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-reset/done/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetDoneView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_done&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-reset/&lt;uidb64&gt;/&lt;token&gt;/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetConfirmView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">success_url</span><span class="o">=</span><span class="s1">&#39;/password-reset/complete&#39;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_confirm&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-reset/complete/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordResetCompleteView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_complete&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<blockquote>
<p><strong>در URL سوم:</strong></p>
<ul>
<li>
<p>پارامتر uidb64: برای نشان دادن شناسه منحصر به فرد کاربر (که در قالب base64 کدگذاری شده است) استفاده میشود. از آن برای رمزگشایی و شناسایی کاربری(user) که برای او ریست پسورد درخواست شده است استفاده میشود.</p>
</li>
<li>
<p>پارامتر توکن: برای تأیید اعتبار request و اطمینان از اینکه لینک ریست پسورد، دستکاری نشده باشد استفاده میشود. | برای بررسی معتبر بودن لینک استفاده میشود.</p>
</li>
</ul>
</blockquote>
<h4><strong>ایجاد تمپلیت برای url های ریست پسورد:</strong></h4>
<blockquote>
<ol>
<li>
<p><span class="en-text">password_reset_form.html</span></p>
</li>
<li>
<p><span class="en-text">password_reset_email.html</span></p>
</li>
<li>
<p><span class="en-text">password_reset_done.html</span></p>
</li>
<li>
<p><span class="en-text">password_reset_confirm.html</span></p>
</li>
<li>
<p><span class="en-text">password_reset_complete.html</span></p>
</li>
</ol>
</blockquote>
<p><span class="rtl-text">تمامی تمپلیت ها در مسیر <code>templates/registration</code> قرار میگیرند، بنابراین برای راحتی مسیر را از registration نشان میدهیم.</span></p>
<h4>template 1:</h4>
<p><code>registration/password_reset_form.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">reset pasword</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Reset Password&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Enter your Email please...&lt;/p&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">    </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">    &lt;input type=&quot;submit&quot; value=&quot;Send Email&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4>template 2:</h4>
<p>در تمپلیت password_reset_email، متن ایمیل که به کاربر ارسال میشه را ایجاد میکنیم.</p>
<p><code>registration/password_reset_email.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">&lt;!-- Email text --&gt;</span>
<span class="x">Subject: Password reset request</span>

<span class="x">Dear </span><span class="cp">{{</span> <span class="nv">user.get_username</span> <span class="cp">}}</span><span class="x">,</span>

<span class="x">We have received a request to reset your password with the email and username below.</span>

<span class="x">Username: </span><span class="cp">{{</span> <span class="nv">user.get_username</span> <span class="cp">}}</span>
<span class="x">Email: </span><span class="cp">{{</span> <span class="nv">email</span> <span class="cp">}}</span>

<span class="x">If you did not make this request, please ignore this email.</span>

<span class="x">Click the link below to reset the password:</span>

<span class="cp">{{</span> <span class="nv">protocol</span> <span class="cp">}}</span><span class="x">://</span><span class="cp">{{</span> <span class="nv">domain</span> <span class="cp">}}{%</span> <span class="k">url</span> <span class="s1">&#39;Blog:password_reset_confirm&#39;</span> <span class="nv">uidb64</span><span class="o">=</span><span class="nv">uid</span> <span class="nv">token</span><span class="o">=</span><span class="nv">token</span> <span class="cp">%}</span>
</pre></div>

<blockquote>
<p>متغیرهایی که استفاده میکنیم توسط سیستم احراز هویت جنگو به صورت پیشفرض تعریف شده اند.</p>
</blockquote>
<h4>template 3:</h4>
<p><code>registration/password_reset_done.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">reset pasword</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Reset Password&lt;/h1&gt;</span>

<span class="x">    &lt;p&gt;password change link was sent to you, please check your email❤️&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4>template 4:</h4>
<p>در تمپلیت password_reset_confirm پسورد جدید را وارد میکنیم.</p>
<p><code>registration/password_reset_confirm.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">reset pasword</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Reset Password&lt;/h1&gt;</span>

<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">validlink</span> <span class="cp">%}</span>
<span class="x">        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>
<span class="x">            &lt;input type=&quot;submit&quot; value=&quot;change password&quot;&gt;</span>
<span class="x">        &lt;/form&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">        your link is not valid...</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> </span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<blockquote>
<ul>
<li>
<p>توکنی که توی url استفاده شده بررسی میکنه لینکی که کاربر کلیک کرده معتبر هست یا نه؟!</p>
</li>
<li>
<p>عبارت validlink توی تمپلیت password_reset_confirm کمک میکنه چک کنیم، آیا لینکی که کاربر وارد شده معتبره یا نه؟!!</p>
</li>
</ul>
<p>بنابراین، وجود توکن در URL و استفاده از validlink در تمپلیت، هردو برای بررسی اعتبار لینک بازنشانی رمز عبور کاربرد دارند.</p>
</blockquote>
<h4>template 5:</h4>
<p><code>registration/password_reset_complete.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x">reset pasword</span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Reset Password&lt;/h1&gt;</span>

<span class="x">    &lt;p&gt;Your password was changed successfully&lt;/p&gt;</span>

<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:login&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Login&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<blockquote>
<p>ریست پسورد، برای زمانیست که کاربر رمز خود را فراموش کرده است؛ بنابراین لینک ریست پسورد را در صفحه لاگین قرار میدهیم.</p>
</blockquote>
<p><code>templates/registration/login.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Login </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;login&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Enter your informations please...&lt;/p&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;hidden&quot; name=&quot;next&quot; value=&quot;</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span>
<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;login&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="x">    &lt;p&gt;</span>
<span class="x">        &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:password_reset&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Forgot your Password?&lt;/a&gt;</span>
<span class="x">    &lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4>سیستم ارسال ایمیل:</h4>
<p>چون در حال حاضر سیستم ارسال ایمیل نداریم باید مشخص کنیم که ایمیل ارسالی را در کنسول نمایش دهد.</p>
<p>در انتهای کد تنظیمات متغیر EMAIL_BACKEND را اضافه میکینم:</p>
<p><code>project directry/settings.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">EMAIL_BACKEND</span> <span class="o">=</span> <span class="n">django</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">mail</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">console</span><span class="o">.</span><span class="n">EmailBackend</span><span class="s1">&#39;</span>
</pre></div>

<p><strong>نکته مهم:</strong> ارسال ایمیل برای کاربرانی انجام میشود که در اطلاعات کاربری خود ایمیل ثبت کرده باشند.</p>
<p>پس اگر گاربری ایمیل نداشته باشد نمیتواند ریست پسورد را انجام دهد.</p>
<h3 id="thbt-nm-register">ثبت نام (register)</h3>
<p>برای ثبت نام(register or sign-up) یک فرم در forms.py ایجاد میکنیم:</p>
<p><code>app directory/forms.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">UserRegisterForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">)</span>
    <span class="n">repeat_password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">clean_repeat_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleaned_data</span>

        <span class="n">password</span> <span class="o">=</span> <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
        <span class="n">repeat_password</span> <span class="o">=</span> <span class="n">cd</span><span class="p">[</span><span class="s1">&#39;repeat_password&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">password</span> <span class="o">!=</span> <span class="n">repeat_password</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">forms</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Passwords must match.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">repeat_password</span>
</pre></div>

<p>1- فیلد پسورد را جدا ایجاد میکنیم، برای اینکه میخواهیم برای تکرار پسورد هم یک فیلد داشه باشیم و در ضمن باید تطابق این دو فیلد پسورد؛ بررسی شود برای همین آن دو فیلد را خارج از کلاس Meta تعریف میکنیم.</p>
<p>2- اعتبارسنجی برای تطابق پسورد ها را انجام میدهیم.</p>
<h4><strong>ایجاد URL برای صفحه ثبت نام:</strong></h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;register/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;register&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<h4><strong>ایجاد view برای صفحه ثبت نام:</strong></h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UserRegisterForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;registration/register_done.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UserRegisterForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;registration/register.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>

<p><strong>توضیحات:</strong></p>
<blockquote>
<p>جنگو hash شده پسورد را ذخیره و از آن استفاده میکند.</p>
<p>الگوریتم های مختلفی برای hash کردن دارد؛ الگوریتم پیشفرض آن SHA256 میباشد.</p>
</blockquote>
<p>برای ذخیره پسورد کاربر، در دیتابیس از متد <span class="en-text">set_password()</span> استفاده میکنیم؛ این متد از الگوریتم پیشفرض جنگو استفاده کرده و پسورد را به صورت هش شده ذخیره میکند.</p>
<blockquote>
<p>برای ثبت نام دو تمپلیت ایجاد میکنیم:</p>
<p>1- برای نمایش پیام "ثبت نام شما با موفقیت انجام شد" به کاربر </p>
<p>2- نمایش فرم ثبت نام</p>
</blockquote>
<h4>template 1:</h4>
<p><code>templates/registration/register.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Register </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Register&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Enter your informations please&lt;/p&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;Register&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4>template 2:</h4>
<p><code>templates/registration/register_done.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Register done </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Dear </span><span class="cp">{{</span> <span class="nv">user</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;You have successfully registered 😍&lt;/p&gt;</span>

<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:login&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Login&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4>دکمه ثبت نام:</h4>
<p>برای ثبت نام یک دکمه، کنار دکمه ورود در header ایجاد میکنیم.</p>
<p><code>templates/partials/header.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">&lt;!-- search field --&gt;</span>
<span class="x">&lt;form action=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;Blog:post_search&#39;</span> <span class="cp">%}</span><span class="x">&quot; method=&quot;get&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;text&quot; name=&quot;query&quot; required placeholder=&quot;عبارت مدنظر را وارد کنید&quot;&gt;</span>
<span class="x">    &lt;input type=&quot;submit&quot; value=&quot;search&quot;&gt;</span>
<span class="x">&lt;/form&gt;</span>

<span class="x">&lt;!-- profile link --&gt;</span>
<span class="x">&lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:profile&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;profile&lt;/a&gt;&lt;/p&gt;</span>


<span class="cp">{%</span> <span class="k">if</span> <span class="nv">request.user.is_authenticated</span> <span class="cp">%}</span>
<span class="x">    &lt;div&gt;</span>
<span class="x">        &lt;a href=&quot;#&quot;&gt;</span><span class="cp">{{</span> <span class="nv">request.user.first_name</span> <span class="o">|</span> <span class="nf">default</span><span class="o">:</span><span class="nv">request.user.username</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">    &lt;!-- ___________________ login &amp; register button ___________________ --&gt;</span>
<span class="x">    &lt;!-- login button --&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:login&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Login&lt;/a&gt;</span>
<span class="x">    &lt;!-- register button --&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:register&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Register&lt;/a&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>

<h3 id="tws-h-mdl-user-w-wyrysh-tl-t-shkhsy">توسعه مدل User و ویرایش اطلاعات شخصی</h3>
<p>برای توسعه مدل User میتوانیم از دو روش استفاده کنیم:</p>
<p>1- ایجاد یک مدل جدید که شامل فیلدهای  اضافی مثل (بیوگرافی، شغل، تصویر پروفایل و...) میباشد و اتصال آن به مدل User</p>
<p>2- بجای استفاده از مدل پیشفرض جنگو، مدل شخصی سازی خود را ایجاد میکنیم.</p>
<p><strong>در این بخش، از حالت اول استفاده میکنیم.</strong></p>
<h4>ایجاد مدل جدید:</h4>
<p>یک مدل جدید نوشته و برای آن فیلدهای جدیدی که میخواهیم مدل User داشته باشد ، مشخص میکنیم. | میتوان از اسم account و یا profile برای این مدل استفاده کرد.</p>
<p><code>app directory/models.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">Account</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;account&#39;</span><span class="p">)</span>

    <span class="n">avatar</span> <span class="o">=</span> <span class="n">ResizedImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;profile_image&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span> <span class="n">quality</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">],</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bio</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">job</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">birth_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>

<p><strong>توضیحات:</strong></p>
<p>1- اولین فیلد user هست که از فیلد رابطه ای OneToOne ایجاد شده و آنرا به مدل User متصل کرده ایم.</p>
<blockquote>
<p>برای هر کاربر این ویژگی های جدید را اضافه میکنیم. | هر user یک account خواهد داشت و هر اکانتی به یک کاربر متصله برای همین از فیلد 1to1 استفاده میکنیم.</p>
</blockquote>
<p>2- به غیر از user سایر فیلدها را اختیاری قرار میدهیم. (به کمک آرگومان های null و blank)</p>
<blockquote>
<p>پس از ایجاد مدل دستورات makemigrations و migrate فراموش نشه!</p>
</blockquote>
<h4><strong>بریم مدل اکانت را در پنل ادمین نمایش دهیم:</strong></h4>
<p><code>app directory/admin.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Account</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AccountAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;job&#39;</span><span class="p">,</span> <span class="s1">&#39;birth_date&#39;</span><span class="p">,</span> <span class="s1">&#39;avatar&#39;</span><span class="p">]</span>
</pre></div>

<h4><strong>تغییر view مربوط به register(ثبت نام):</strong></h4>
<p>در آموزش قبلی برای ثبت نام یک view ایجاد کردیم که یک کاربر با فیلدها و قابلیت های محدود ایجاد میکرد و تمام ولی الآن که برای سایر فیلدها یک مدل جدید ایجاد کردیم؛ باید برای هر کاربری که ثبت نام میکنه یک اکانت هم ایجاد شود.</p>
<p>برای همین در view ثبت نام پس از ایجاد کاربر یک آبجکت برای مدل account ایجاد میکنیم، و آنرا به این کاربر جدید متصل میکنیم.</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UserRegisterForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

            <span class="c1"># ایجاد آبجکت اکانت و اتصال به کاربر جدید</span>
            <span class="n">Account</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;registration/register_done.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">user</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">UserRegisterForm</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;registration/register.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>

<h4><strong>قابلیت ویرایش اطلاعات شخصی برای هر کاربر:</strong></h4>
<p>خب حالا میخواهیم قابلیت ویرایش اطلاعات شخصی را برای هر کاربر در صفحه  پروفایل ایجاد کنیم.</p>
<h4>ایجاد فرم ویرایش اطلاعات شخصی در forms.py:</h4>
<p>در حال حاضر برای مشخصات کاربری(اطلاعات شخصی) دو مدل داریم: 1- مدل User 2- مدل Account بنابراین در forms.py  دو فرم برای ویرایش اطلاعات ایجاد میکنیم:</p>
<p><code>app directory/forms.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">UserEditForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">]</span>


<span class="c1"># ----------------------------------------------------------------------------</span>
<span class="k">class</span> <span class="nc">AccountEditForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Account</span>
        <span class="c1"># user همه فیلدها بجز فیلد</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
</pre></div>

<h4>ایجاد view برای ویرایش اطلاعات شخصی:</h4>
<p>خب بریم مثله ویرایش پست، برای فرم ویرایش اطلاعات شخصی یک view ایجاد کنیم:</p>
<p>چون دو تا فرم داریم اطلاعات دریافتی از فرم تمپلیت را در هردو فرم ارسال میکنیم.</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">edit_account</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserEditForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">account_form</span> <span class="o">=</span> <span class="n">AccountEditForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">account_form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user_form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">account_form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;blog:profile&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">user_form</span> <span class="o">=</span> <span class="n">UserEditForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="n">account_form</span> <span class="o">=</span> <span class="n">ProfileEditForm</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">account</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;user_form&#39;</span><span class="p">:</span> <span class="n">user_form</span><span class="p">,</span>
        <span class="s1">&#39;account_form&#39;</span><span class="p">:</span> <span class="n">account_form</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;registration/edit_account.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>

<p><strong>توضیحات:</strong></p>
<p>1- چون برای ویرایش یک آبجکت از قبل وجود داره، بنابراین برای فرم ها از آرگومان instance استفاده کرده و آبجکت را برایش مشخص میکنیم.</p>
<blockquote>
<p>برای دسترسی به اکانت کاربر، از related_name مدل account استفاده کرده ایم. request.user.account</p>
</blockquote>
<p>2- برای فرم اکانت تصویر هم داریم بنابراین لازم است از آرگومان request.FILES استفاده کنیم.</p>
<p>3- چون دیگر قرار نیست، اطلاعاتی به آبجکت های فرم اضافه کنیم؛ و فرم ها را مستقیم در دیتابیس ذخیره میکنیم، دیگه از آرگومان commit=False استفاده نمیکنیم.</p>
<h4>ایجاد URL برای فرم ویرایش اطلاعات شخصی:</h4>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;profile/edit-account/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">edit_account</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;edit_account&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<h4>ایجاد تمپلیت ویرایش اطلاعات شخصی(مشخصات کاربری):</h4>
<p>چون در فرم از فایل استفاده میکنیم؛ <strong>لازم است</strong> برای تگ form از اتریبیوت enctype استفاده کنیم.</p>
<p><code>templates/registration/edit_account.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Edit Account </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Edit personal information&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Edit your information please&lt;/p&gt;</span>

<span class="x">    &lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">user_form.as_p</span> <span class="cp">}}</span>
<span class="x">        </span><span class="cp">{{</span> <span class="nv">account_form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;save&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4>ایجاد دکمه ویرایش مشخصات کاربری:</h4>
<p>در صفحه پروفایل یک دکمه برای ویرایش مشخصات کاربری ایجاد میکنیم:</p>
<p><code>templates/blog/profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Profile&lt;/h1&gt;</span>

<span class="x">    &lt;!-- logout button --&gt;</span>
<span class="x">    &lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:logout&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Logout&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">    &lt;!-- Change Password button --&gt;</span>
<span class="x">    &lt;p&gt;&lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:password_change&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Change Password&lt;/a&gt;&lt;/p&gt;</span>

<span class="x">    &lt;!-- create post button --&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:create_post&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Create Post&lt;/a&gt;</span>

<span class="x">    &lt;!-- edit account button --&gt;</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;Blog:edit_account&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;edit account&lt;/a&gt;</span>

<span class="x">    &lt;!-- ادامه کدها --&gt;</span>
<span class="x">    ...</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p><strong>نکته مهم:</strong></p>
<blockquote>
<p>برای کاربرانی که از قبل وجود داشتند باید اکانت نیز داشته باشند در غیر این صورت برای ویرایش اطلاعات شخصی آنها ارور میدهد.</p>
</blockquote>
<h3 id="dsth-bndy-sdh">دسته بندی ساده</h3>
<p>دسته بندی در اصل با ایجاد یک مدل مجزا و اتصال آن به مدل پست و انجام یکسری کارها صورت میگیرد ولی در حال حاضر از یک حالت ساده و بدون استفاده از مدل، دسته بندی را ایجاد میکینم.</p>
<p>برای مدل Post یک فیلد انتخابی ایجاد میکنیم؛ برای راحتی بجای استفاده از کلاس مثل status از تاپل برای ایجاد حالت انتخابی استفاده میکنیم.</p>
<p><code>app directory/models.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Status</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TextChoices</span><span class="p">):</span>
        <span class="n">Draft</span> <span class="o">=</span> <span class="s1">&#39;DF&#39;</span><span class="p">,</span> <span class="s1">&#39;Draft&#39;</span>
        <span class="n">Published</span> <span class="o">=</span> <span class="s1">&#39;PB&#39;</span><span class="p">,</span> <span class="s1">&#39;Published&#39;</span>
        <span class="n">Rejected</span> <span class="o">=</span> <span class="s1">&#39;RJ&#39;</span><span class="p">,</span> <span class="s1">&#39;Rejected&#39;</span>

    <span class="c1"># ️ ⬆️ choice-field ⬆️</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">Draft</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------</span>

    <span class="n">CATEGORY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;TECH&#39;</span><span class="p">,</span> <span class="s1">&#39;Technology&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;AI&#39;</span><span class="p">,</span> <span class="s1">&#39;Artificial Intelligence&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;PL&#39;</span><span class="p">,</span> <span class="s1">&#39;Programming Language&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;OTHER&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">CATEGORY_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;OTHER&#39;</span><span class="p">)</span>

    <span class="c1"># another codes</span>
    <span class="c1"># ...</span>
</pre></div>

<p><strong>توضیحات:</strong></p>
<p>1- یک تاپل که همه دسته بندی در آن قرار میگیرند؛ حالا داخل این تاپل، برای هر دسته بندی هم از تاپل استفاده میکنیم.</p>
<blockquote>
<ul>
<li>برای هر دسته بندی(تاپل ها) اولین مقدار در دیتابیس ذخیره میشود و مقدار دوم به کاربر نمایش داده میشود.</li>
</ul>
</blockquote>
<p>2- حالا یک فیلد از نوع CharField ایجاد کرده و برای آرگومان choice آن، اسم تاپل را مشخص میکنیم؛ و با آرگومان default هم یکی از گزینه ها را جهت نمایش انتخاب میکنیم.</p>
<blockquote>
<p>چون در مدل تغییر ایجاد کردیم باید از دستورات makemigrations و migrate استفاده کنیم.</p>
</blockquote>
<h4><strong>تغییر فرم افزودن پست:</strong></h4>
<p>در forms.py برای فرم Create_Post،  فیلد category(دسته بندی) را اضافه میکنیم.</p>
<p><code>app directory/forms.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">CreatePostForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="n">image1</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;image1&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">image2</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;image2&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
        <span class="c1"># add category field</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;reading_time&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]</span>
</pre></div>

<p><strong>حالا برای نمایش پست ها در تمپلیت post_list دو حالت داریم: 1- نمایش تمام پست ها 2- نمایش پست ها براساس یک دسته بندی خاص</strong></p>
<h4><strong>ایجاد URL برای لیست پست ها:</strong></h4>
<p>برای لیست پست ها به دو URL احتیاج داریم 1- url که دارای متغیر category (برای فیلتر پست ها براساس یک دسته بندی) میباشد 2- url که متغیر ندارد (برای نمایش تمام پست ها بکار میرود).</p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;posts/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">post_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;post_list&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;posts/&lt;str:category&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">post_list</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;post_list_category&#39;</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>

<h4><strong>تغییر ساختار view برای لیست پست ها:</strong></h4>
<p>1- از تابع برای این view استفاده میکنیم.</p>
<p>2- برای این تابع یک آرگومان بنام category ایجاد میکنیم و پیشفرض آنرا None مشخص میکنیم.</p>
<blockquote>
<p>وقتی متغیر category را اختیاری مشخص کنیم؛ اگه دسته بندی توسط url ارسال شد که آنرا دریافت کرده و پست ها را براساس آن دسته بندی فیلتر میکنیم اگر هم ارسال نشد که مقدار پیشفرض None دارد و در نتیجه تمام پست ها را نمایش میدهیم.</p>
<p>این طوری هر دو حالت را در یک view مدیریت میکنیم.</p>
</blockquote>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">post_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">page_number</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page_number</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PageNotAnInteger</span><span class="p">:</span>
        <span class="n">posts</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;posts&#39;</span><span class="p">:</span> <span class="n">posts</span><span class="p">,</span>
        <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/post_list.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>

<p><strong>توضیحات:</strong></p>
<p>1- برای استفاده از category، یک شرط میگذاریم که اگر دسته بندی وجود داشت؛ پست هایی که آن دسته بندی را دارند انتخاب کن و اگر دسته بندی وجود نداشت تمام پست های منتشر شده را انتخاب کن.</p>
<h4><strong>تغییر تمپلیت لیست پست ها:</strong></h4>
<blockquote>
<p>برای تگ h1 یک شرط مشخص میکنیم،</p>
<ul>
<li>
<p>اگر دسته بندی وجود داشت متن این تگ را "لیست پست ها بر اساس دسته بندی ......"</p>
</li>
<li>
<p>و در غیر این صورت متن این تگ را "تمام پست ها" قرار دهد.</p>
</li>
</ul>
</blockquote>
<p>برای راحتی سایر کدها نوشته نشده اند.</p>
<p><code>templates/blog/post_list.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">...</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">category</span> <span class="cp">%}</span>
<span class="x">        &lt;h1&gt;لیست پست ها بر اساس دسته بندی </span><span class="cp">{{</span> <span class="nv">category</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">        &lt;h1&gt;تمام پست ها&lt;/h1&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">...</span>
</pre></div>

<h4><strong>استفاده از دسته بندی برای پست ها:</strong></h4>
<p>یک لیست از دسته بندی ها (با استفاده از تگ a) ایجاد میکنیم و برای هر کدام از دسته بندی ها یک URL به صفحه لیست پست ها مشخص میکنیم.</p>
<p><code>templates/blog/post_list.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">...</span>
<span class="x">    &lt;div class=&quot;content&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;categories&quot;&gt;</span>
<span class="x">            &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:post_list&#39;</span> <span class="s1">&#39;TECH&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Technology&lt;/a&gt;</span>
<span class="x">            &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:post_list&#39;</span> <span class="s1">&#39;AI&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Intelligence&lt;/a&gt;</span>
<span class="x">            &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:post_list&#39;</span> <span class="s1">&#39;PL&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Programming Language&lt;/a&gt;</span>
<span class="x">            &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:post_list&#39;</span> <span class="s1">&#39;OTHER&#39;</span> <span class="cp">%}</span><span class="x">&quot;&gt;Other&lt;/a&gt;</span>
<span class="x">        &lt;/div&gt;</span>

<span class="x">        &lt;div class=&quot;posts&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">category</span> <span class="cp">%}</span>
<span class="x">                &lt;h1&gt;لیست پست ها بر اساس دسته بندی </span><span class="cp">{{</span> <span class="nv">category</span> <span class="cp">}}</span><span class="x">&lt;/h1&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">                &lt;h1&gt;تمام پست ها&lt;/h1&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="x">            </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
<span class="x">                &lt;!-- نمایش هر پست --&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">...</span>
</pre></div>

<h4><strong>اضافه کردن دسته بندی به پست در پنل ادمین:</strong></h4>
<p><code>app directory/admin.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;publish&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]</span>
    <span class="c1"># ...</span>
</pre></div>

<p>کد ساختار پنل ادمین برای مدل پست:</p>
<p><code>app directory/admin.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PostAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;publish&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-publish&#39;</span><span class="p">,</span> <span class="s1">&#39;-author&#39;</span><span class="p">]</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;publish&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">]</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">]</span>
    <span class="n">raw_id_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;author&#39;</span><span class="p">]</span>
    <span class="n">date_hierarchy</span> <span class="o">=</span> <span class="s1">&#39;publish&#39;</span>
    <span class="n">prepopulated_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;slug&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]}</span>
    <span class="n">list_editable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>

    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ImageInline</span><span class="p">,</span> <span class="n">CommentInline</span><span class="p">]</span>
</pre></div>

<p><strong>نکته مهم:</strong></p>
<p>در URL ها آیدی پست را که برای post_detail استفاده میشه با دسته بندی اشتباه میگیره برای همین URL مربوط به post_detail را تغییر میدهیم.</p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;posts/detail/&lt;int:post_id&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">post_detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;post_detail&#39;</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>

<h3 id="tmrynt-fsl-hftm-w-nkhty-dr-mwrd-blg-mhm">تمرینات فصل هفتم و نکاتی در مورد بلاگ (مهم)</h3>
<h4><strong>T1- ایجاد صفحه ای که اطلاعات و بیوگرافی نویسنده پست را نمایش میدهد، در ضمن تمام پست های نویسنده هم نمایش دهد:</strong></h4>
<p><strong>a- ایجاد URL برای صفحه ی پروفایل نویسنده:</strong></p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;author-profile/&lt;str:username&gt;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">author_profile</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;author_profile&#39;</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>

<p><strong>b- ایجاد view برای صفحه ی پروفایل نویسنده:</strong></p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">author_profile</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author__username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
        <span class="s2">&quot;posts&quot;</span><span class="p">:</span> <span class="n">posts</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/author_profile.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>

<p><strong>c- ایجاد template برای صفحه ی پروفایل نویسنده:</strong></p>
<p><code>templates/blog/author_profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> author Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;div class=&quot;author-Profile&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.first_name</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{{</span> <span class="nv">user.first_name</span> <span class="cp">}}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{{</span> <span class="nv">user.usernaem</span> <span class="cp">}}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">with</span> <span class="nv">account</span><span class="o">=</span><span class="nv">user.account</span> <span class="cp">%}</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">account.avatar</span> <span class="cp">%}</span>
<span class="x">                &lt;img src=&quot;account.avatar.url&quot; alt=&quot;account.avatar&quot;&gt;</span>
<span class="x">            </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="x">            Bio: </span><span class="cp">{{</span> <span class="nv">account.bio</span> <span class="cp">}}</span>
<span class="x">            Job: </span><span class="cp">{{</span> <span class="nv">account.job</span> <span class="cp">}}</span>
<span class="x">            date of birth: </span><span class="cp">{{</span> <span class="nv">account.birth_date</span> <span class="cp">}}</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endwith</span> <span class="cp">%}</span>
<span class="x">    &lt;/div&gt;</span>

<span class="x">    &lt;div class=&quot;posts&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
<span class="x">            &lt;!-- نمایش جزئیات هر پست --&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">    &lt;/div&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p>در صفحه post_detail، نویسنده پست را مشخص کرده ایم؛ حالا آنرا داخل تگ a نوشته و برای href آن آدرس صفحه "پروفایل نویسنده" را مشخص میکنیم.</p>
<p><code>templates/blog/post_detail.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">...</span>
<span class="x">    &lt;a href=&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;blog:author_profile&#39;</span> <span class="nv">post.author.username</span> <span class="cp">%}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">post.author</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;</span>
<span class="x">...</span>
</pre></div>

<h4><strong>T2- در صفحه پروفایل برای هر پست تمام کامنت هایش را نمایش دهد:</strong></h4>
<p>میخواهیم کامنت های هر پست را به صورت پنجره modal در صفحه پروفایل نمایش دهیم.</p>
<blockquote>
<p>برای این کار:</p>
<p>1- از بوت استرپ در پروژه خود استفاده میکنیم. <br />
2- برای هر پست یک دکمه ایجاد کرده تا با آن پنجره modal باز شود. <br />
3- یک تمپلیت برای ساختار پنجره modal ایجاد میکنیم.</p>
</blockquote>
<p><strong>برای درک بهتر فقط بخش های اصلی کد پروفایل را مینویسیم.</strong></p>
<p><code>templates/blog/profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="x">&lt;!-- ___________________________ bootstrap ___________________________ --&gt;</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">head</span> <span class="cp">%}</span><span class="x"> </span>
<span class="x">    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Profile&lt;/h1&gt;</span>

<span class="x">    &lt;table&gt;</span>
<span class="x">        &lt;caption&gt;All Post&lt;/caption&gt;</span>
<span class="x">        &lt;tr&gt;</span>
<span class="x">            &lt;th&gt;row&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;title&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;edit&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;delete&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;status&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;comments&lt;/th&gt;</span>
<span class="x">        &lt;/tr&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">all_posts</span> <span class="cp">%}</span>
<span class="x">            &lt;tr&gt;</span>
<span class="x">                &lt;!-- row --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">                &lt;!-- title --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">get_absolute_url</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">                &lt;!-- edit --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;#&quot;&gt;edit&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">                &lt;!-- delete --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;#&quot;&gt;delete&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">                &lt;!-- status --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">post.status</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>

<span class="x">                &lt;!-- show-comment button --&gt;</span>
<span class="x">                &lt;td&gt;&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; data-bs-toggle=&quot;modal&quot; data-bs-target=&quot;#postModal</span><span class="cp">{{</span> <span class="nv">post.id</span> <span class="cp">}}</span><span class="x">&quot;&gt;مشاهده نظرات&lt;/button&gt;&lt;/td&gt;</span>
<span class="x">            &lt;/tr&gt;</span>

<span class="x">            </span><span class="cp">{%</span> <span class="k">include</span> <span class="s2">&quot;blog/modal_comment.html&quot;</span> <span class="k">with</span> <span class="nv">post</span><span class="o">=</span><span class="nv">post</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">    &lt;/table&gt;</span>

<span class="x">    &lt;!-- -------------  صفحه بندی همه پست ها  ------------- --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/pagination.html&#39;</span> <span class="k">with</span> <span class="nv">page</span><span class="o">=</span><span class="nv">all_posts</span> <span class="cp">%}</span>

<span class="x">&lt;!--_________ سایر کدها _________--&gt;</span>
<span class="x">    ...</span>

<span class="x">    &lt;!-- ___________________________ bootstrap ___________________________ --&gt;</span>
<span class="x">    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;</span>
<span class="x">    </span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p><strong>تمپلیت برای پنجره modal:</strong></p>
<p><code>templates/blog/modal_comment.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="x">&lt;div class=&quot;modal fade&quot; id=&quot;postModal</span><span class="cp">{{</span> <span class="nv">post.id</span> <span class="cp">}}</span><span class="x">&quot; tabindex=&quot;-1&quot; aria-labelledby=&quot;postModalLabel</span><span class="cp">{{</span> <span class="nv">post.id</span> <span class="cp">}}</span><span class="x">&quot; aria-hidden=&quot;true&quot;&gt;</span>
<span class="x">    &lt;div class=&quot;modal-dialog modal-lg&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;modal-content&quot;&gt;</span>
<span class="x">            &lt;div class=&quot;modal-header&quot;&gt;</span>
<span class="x">                &lt;h5 class=&quot;modal-title&quot; id=&quot;postModalLabel</span><span class="cp">{{</span> <span class="nv">post.id</span> <span class="cp">}}</span><span class="x">&quot;&gt;نظرات برای پست: </span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="x">&lt;/h5&gt;</span>
<span class="x">                &lt;button type=&quot;button&quot; class=&quot;btn-close&quot; data-bs-dismiss=&quot;modal&quot; aria-label=&quot;Close&quot;&gt;&lt;/button&gt;</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">            </span>
<span class="x">            &lt;div class=&quot;modal-body&quot;&gt;</span>
<span class="x">                &lt;ul&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">comment</span> <span class="k">in</span> <span class="nv">post.comments.all</span> <span class="cp">%}</span>
<span class="x">                        &lt;p&gt;name: </span><span class="cp">{{</span> <span class="nv">comment.name</span> <span class="cp">}}</span><span class="x">&lt;/p&gt;</span>
<span class="x">                        &lt;li&gt;Content: </span><span class="cp">{{</span> <span class="nv">comment.letter</span> <span class="o">|</span> <span class="nf">linebreaks</span> <span class="cp">}}</span><span class="x">&lt;/li&gt;</span>
<span class="x">                        &lt;hr&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">empty</span> <span class="cp">%}</span>
<span class="x">                        &lt;li&gt;No comments yet.&lt;/li&gt;</span>
<span class="x">                    </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">                &lt;/ul&gt;</span>
<span class="x">            &lt;/div&gt;</span>

<span class="x">            &lt;div class=&quot;modal-footer&quot;&gt;</span>
<span class="x">                &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot; data-bs-dismiss=&quot;modal&quot;&gt;بستن&lt;/button&gt;</span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">&lt;/div&gt;</span>
</pre></div>

<p><strong>برای نمایش بهتر کامنت ها در پنجره modal، میتوانید از استایل های زیر هم استفاده کنید.</strong></p>
<p><code>css</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">css</span>
        </div>
    <pre><span></span><span class="p">.</span><span class="nc">modal-body</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">min-height</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="kt">px</span><span class="p">;</span>
<span class="w">        </span><span class="k">max-height</span><span class="p">:</span><span class="w"> </span><span class="mi">350</span><span class="kt">px</span><span class="p">;</span>
<span class="w">        </span><span class="k">overflow-y</span><span class="p">:</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="p">.</span><span class="nc">modal-body</span><span class="w"> </span><span class="nt">ul</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">position</span><span class="p">:</span><span class="w"> </span><span class="kc">relative</span><span class="p">;</span>
<span class="w">        </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">flex</span><span class="p">;</span>
<span class="w">        </span><span class="k">flex</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kc">auto</span><span class="p">;</span>
<span class="w">        </span><span class="k">flex-direction</span><span class="p">:</span><span class="w"> </span><span class="kc">column</span><span class="p">;</span>
<span class="w">        </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="nv">--bs-modal-padding</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>

<h4><strong>T3- در صفحه پروفایل برای نمایش پست ها صفحه بندی پیاده سازی کنید:</strong></h4>
<p>برای همه پست های کاربر، صفحه بندی را پیاده سازی میکینم:</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">def</span> <span class="nf">profile</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
    <span class="n">pub_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">all_posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

    <span class="c1"># Pagination &lt;=&gt; صفحه بندی</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">all_posts</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">page_number</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">page_number</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">EmptyPage</span><span class="p">:</span>
        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">paginator</span><span class="o">.</span><span class="n">num_pages</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PageNotAnInteger</span><span class="p">:</span>
        <span class="n">all_posts</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pub_posts&quot;</span><span class="p">:</span> <span class="n">pub_posts</span><span class="p">,</span>
        <span class="s2">&quot;all_posts&quot;</span><span class="p">:</span> <span class="n">all_posts</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;blog/profile.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
</pre></div>

<p><strong>نمایش صفحه بندی در تمپلیت:</strong></p>
<p><code>templates/blog/profile.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">load</span> <span class="nv">static</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Profile </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Profile&lt;/h1&gt;</span>

<span class="x">    &lt;table&gt;</span>
<span class="x">        &lt;caption&gt;All Post&lt;/caption&gt;</span>
<span class="x">        &lt;tr&gt;</span>
<span class="x">            &lt;th&gt;row&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;title&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;edit&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;delete&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;status&lt;/th&gt;</span>
<span class="x">        &lt;/tr&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">all_posts</span> <span class="cp">%}</span>
<span class="x">            &lt;tr&gt;</span>
<span class="x">                &lt;!-- row --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">                &lt;!-- title --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">get_absolute_url</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">                &lt;!-- edit --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;#&quot;&gt;edit&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">                &lt;!-- delete --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;#&quot;&gt;delete&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">                &lt;!-- status --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">post.status</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">            &lt;/tr&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">    &lt;/table&gt;</span>

<span class="x">&lt;!-- ---------------------------------------------------------------------- --&gt;</span>
<span class="x">    &lt;!-- صفحه بندی همه پست ها --&gt;</span>
<span class="x">    </span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;partials/pagination.html&#39;</span> <span class="k">with</span> <span class="nv">page</span><span class="o">=</span><span class="nv">all_posts</span> <span class="cp">%}</span>
<span class="x">&lt;!-- ---------------------------------------------------------------------- --&gt;</span>

<span class="x">    &lt;table&gt;</span>
<span class="x">        &lt;caption&gt;Published Post&lt;/caption&gt;</span>
<span class="x">        &lt;tr&gt;</span>
<span class="x">            &lt;th&gt;row&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;title&lt;/th&gt;</span>
<span class="x">            &lt;th&gt;description&lt;/th&gt;</span>
<span class="x">        &lt;/tr&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">pub_posts</span> <span class="cp">%}</span>
<span class="x">            &lt;tr&gt;</span>
<span class="x">                &lt;!-- row --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">                &lt;!-- title --&gt;</span>
<span class="x">                &lt;td&gt;&lt;a href=&quot;</span><span class="cp">{{</span> <span class="nv">get_absolute_url</span> <span class="cp">}}</span><span class="x">&quot;&gt;</span><span class="cp">{{</span> <span class="nv">post.title</span> <span class="cp">}}</span><span class="x">&lt;/a&gt;&lt;/td&gt;</span>
<span class="x">                &lt;!-- description --&gt;</span>
<span class="x">                &lt;td&gt;</span><span class="cp">{{</span> <span class="nv">post.description</span> <span class="o">|</span> <span class="nf">truncatewords</span><span class="o">:</span><span class="m">4</span> <span class="cp">}}</span><span class="x">&lt;/td&gt;</span>
<span class="x">            &lt;/tr&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="x">    &lt;/table&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4><strong>T4- برای سیستم احراز هویت class-based-view ها را شخصی سازی کنید:</strong></h4>
<p>برای شخصی سازی، form, template را ایجاد کرده و در view به کلاس خود معرفی میکنیم.</p>
<p><strong>در اینجا PasswordChangeView را شخصی سازی میکنیم:</strong></p>
<h4>ایجاد فرم تغییر پسورد:</h4>
<p><code>app directory/forms.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="k">class</span> <span class="nc">CustomPasswordChangeForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">old_password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">)</span>
    <span class="n">new_password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">)</span>
</pre></div>

<blockquote>
<p>برای اینکه اعتبارسنجی‌های لازم به صورت خودکار انجام شود بهتر است از PasswordChangeForm بجای forms.Form ارث بری کنیم. | یا اینکه اعتبارسنجی های لازم را هم اضافه کنیم.</p>
</blockquote>
<h4>ایجاد تمپلیت تغییر پسورد:</h4>
<p><code>registration/password_change_form.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Change Password </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Change Password&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;Enter previous password and new password:&lt;/p&gt;</span>

<span class="x">    &lt;!-- way 1 --&gt;</span>
<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        </span><span class="cp">{{</span> <span class="nv">form.as_p</span> <span class="cp">}}</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;Change Password&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>

<span class="x">    &lt;!-- way 2 --&gt;</span>
<span class="x">    &lt;form method=&quot;post&quot;&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>

<span class="x">        &lt;input type=&quot;text&quot; name=&quot;old_password&quot;&gt;</span>
<span class="x">        &lt;input type=&quot;text&quot; name=&quot;new_password&quot;&gt;</span>

<span class="x">        &lt;input type=&quot;submit&quot; value=&quot;Change Password&quot;&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<p>میتوانیم از فرم آماده استفاده کنیم و یا  با تگ input به صورت دستی فرم را ایجاد کنیم. | هر دو روش در کد بالا نوشته شده اند از یک مورد استفاده کنید.</p>
<h4>شخصی سازی view برای password change:</h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.views</span> <span class="kn">import</span> <span class="n">PasswordChangeView</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse_lazy</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomPasswordChangeForm</span>

<span class="k">class</span> <span class="nc">MyPasswordChange</span><span class="p">(</span><span class="n">PasswordChangeView</span><span class="p">):</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomPasswordChangeForm</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;password_change_done&#39;</span><span class="p">)</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;registration/password_change_form.html&#39;</span>
</pre></div>

<p><strong>در اینجا PasswordChangeDoneView را شخصی سازی میکنیم:</strong></p>
<h4>ایجاد تمپلیت تغییر پسورد:</h4>
<p><code>registration/password_change_done.html</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">jinja</span>
        </div>
    <pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;parent/base.html&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span><span class="x"> Change Password </span><span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="x">    &lt;h1&gt;Password was changed successfully!&lt;/h1&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>

<h4>شخصی سازی view برای password change done:</h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.views</span> <span class="kn">import</span> <span class="n">PasswordChangeDoneView</span>

<span class="k">class</span> <span class="nc">MyPasswordChangeDone</span><span class="p">(</span><span class="n">PasswordChangeDoneView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;registration/password_change_done.html&#39;</span>
</pre></div>

<p><strong>و حالا در urls.py از این view ها استفاده میکینم.</strong></p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-change/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">MyPasswordChange</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;password-change/done/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">MyPasswordChangeDone</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change_done&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>

<p>برای بازنشانی پسورد 4 view و 5 تمپلیت خواهیم داشت؛ برای دریافت ایمیل و رمز جدید نیاز به فرم داریم(پس به 2 فرم نیاز داریم)</p>
<p>در ادامه فقط view ها را ایجاد میکنیم مابقی در طی دوره گفته شده است(مثل ایجاد فرم که در بالا گفته شده و تمپلیت های آنها که در طی دوره ایجاد کردیم)</p>
<h4>شخصی سازی view برای PasswordResetView:</h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.views</span> <span class="kn">import</span> <span class="n">PasswordResetView</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomPasswordResetForm</span>

<span class="k">class</span> <span class="nc">CustomPasswordResetView</span><span class="p">(</span><span class="n">PasswordResetView</span><span class="p">):</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomPasswordResetForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;registration/password_reset_form.html&#39;</span>  <span class="c1"># تمپلیتی که فرم دریافت ایمیل را آنجا نوشته ایم.</span>
    <span class="n">email_template_name</span> <span class="o">=</span> <span class="s1">&#39;registration/password_reset_email.html&#39;</span>   <span class="c1"># متن ایمیل که به کاربر ارسال میشود در این تمپلیت قرار میگیرد(فقط متن ارسالی)</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;password_reset_done&#39;</span><span class="p">)</span>  <span class="c1"># URL مقصد پس از ارسال ایمیل بازنشانی رمز عبور را وارد کنید</span>
</pre></div>

<blockquote>
<p>برای PasswordResetDoneView و PasswordResetCompleteView فرم نداریم و در تمپلیت آنها یک پیام با محتوای "عملیات با موفقیت انجام شد" نمایش میدهیم برای همین شخصی سازی view آنها چیزی ندارد، ولی با این حال شبیه PasswordChangeDoneView انجام میشود.</p>
</blockquote>
<h4>شخصی سازی view برای PasswordResetConfirmView:</h4>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.views</span> <span class="kn">import</span> <span class="n">PasswordResetConfirmView</span>
<span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="n">CustomSetPasswordForm</span>

<span class="k">class</span> <span class="nc">CustomPasswordResetConfirmView</span><span class="p">(</span><span class="n">PasswordResetConfirmView</span><span class="p">):</span>
    <span class="n">form_class</span> <span class="o">=</span> <span class="n">CustomSetPasswordForm</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;registration/password_reset_confirm.html&#39;</span>  <span class="c1"># در این تمپلیت کاربر تایید شده و رمز جدید خود را وارد میکند</span>
    <span class="n">success_url</span> <span class="o">=</span> <span class="n">reverse_lazy</span><span class="p">(</span><span class="s1">&#39;password_reset_complete&#39;</span><span class="p">)</span>  <span class="c1"># URL مقصد پس از بازنشانی رمز عبور را وارد کنید</span>
</pre></div>

<h4><strong>T5- در صفحه ایندکس به صورت رندوم یکی از پست ها را نمایش دهید:</strong></h4>
<p>از دو روش استاده میکنیم،1- یکی با استفاده از ماژول رندوم و 2- دیگری با استفاده از ORM جنگو (ساختار SQL)</p>
<p>با استفاده از ماژول random یک پست را انتخاب کرده و در تمپلیت نمایش میدهیم.</p>
<p><code>app directory/views.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="c1"># first way:</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">random_post</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="k">if</span> <span class="n">all_posts</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># انتخاب یک پست به صورت تصادفی</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;random_post&#39;</span><span class="p">:</span> <span class="n">random_post</span><span class="p">})</span>

<span class="c1"># second way:</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">random_post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">published</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;random_post&#39;</span><span class="p">:</span> <span class="n">random_post</span><span class="p">})</span>
</pre></div>

<blockquote>
<p><span class="rtl-text">علامت ? در متد <span class="en-text">order_by()</span>  باعث می‌شود که دیتابیس، ردیف‌ها را به صورت تصادفی مرتب کند. این به شما امکان می‌دهد تا به سادگی یک ردیف تصادفی از دیتابیس دریافت کنید.</span></p>
</blockquote>
<h3 id="nkhty-dr-khsws-styl-dhy">نکاتی در خصوص استایل دهی</h3>
<blockquote>
<p>برای فرم هایی که به صورت دستی و با تگ اینپوت ایجاد میکنیم، برای استایل دادن؛ برای فیلد ها اتریبیوت کلاس مشخص میکنیم و بهشون استایل میدهیم.</p>
<p>برای فرم هایی هم که به صورت اتوماتیک از کلاس های forms.py ایجاد میکردیم با استفاده از widget برایشان اتریبیوت کلاس مشخص کرده و استایل دهی میکردیم.</p>
<p><strong>ولی برای فیلدهایی که در فرم احراز هویت جنگو هستند چطور استایل دهی کنیم؟! (فرم هایی که از class-based-view سیستم احراز هویت جنگو، ایجاد شده اند)</strong></p>
</blockquote>
<p>1- در forms.py برای آنها فرم ایجاد کرده و از AuthenticationForm ارث بری میکنیم.</p>
<p>2- فیلدهای فرم را ایجاد کرده و با widget برای هر فیلد اتریبیوت مشخص میکنیم؛ و در نهایت استایل دهی میکنیم.</p>
<ul>
<li>کلاس AuthenticationForm باید ایمپورت شود:</li>
</ul>
<p><code>app directory/forms.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="kn">import</span> <span class="n">AuthenticationForm</span>


<span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;username&#39;</span><span class="p">}))</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">PasswordInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">}))</span>
</pre></div>

<p>حالا لازم است در urls.py برای متدهای <strong><span class="en-text">as_view()</span></strong>، هر کدام از ویو های احراز هویت، که فرمشان را تغییر داده ایم از آرگومان authentication_form استفاده کرده و اسم کلاس فرم مربوطه را برایش مشخص کنیم.</p>
<p>فرم ها باید در urls.py ایمپورت شوند.</p>
<p><code>app directory/urls.py</code></p>
<div class="code-box">
        <div class="code-info">
            <button class="copy-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" class="icon-sm"><path fill="currentColor" fill-rule="evenodd" d="M7 5a3 3 0 0 1 3-3h9a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-2v2a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3h2zm2 2h5a3 3 0 0 1 3 3v5h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1h-9a1 1 0 0 0-1 1zM5 9a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h9a1 1 0 0 0 1-1v-9a1 1 0 0 0-1-1z" clip-rule="evenodd"></path></svg>
                <span>Copy code</span>
            </button>
            <span class="language">python</span>
        </div>
    <pre><span></span><span class="kn">from</span> <span class="nn">.forms</span> <span class="kn">import</span> <span class="o">*</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;login/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">authentication_form</span><span class="o">=</span><span class="n">LoginForm</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
            <a href="https://github.com/virapy/django-booklet/edit/seasons-source/season-07.md" target="_blank" class="edit-icon">
                <i class="fa-solid fa-pen-to-square"></i>
            </a>
        </div>
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://virapy.github.io/assets/JS/Django-seasons.js"></script>
<script src="https://virapy.github.io/assets/JS/copy-icon.js"></script>
<script src="https://virapy.github.io/assets/JS/Footer-Copyright.js"></script>
</body>
</html>
    